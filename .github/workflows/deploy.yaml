name: Recipe Rush CI/CD

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest [web:21]
    steps:
    - uses: actions/checkout@v4 [web:21]

    - name: Install kubectl [web:21]
      run: |
        curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
        chmod +x kubectl
        sudo mv kubectl /usr/local/bin/
        kubectl version --client [web:21]

    - name: Setup Kubeconfig [web:21]
      env:
        KUBE_CONFIG: ${{ secrets.KUBE_CONFIG }}
      run: |
        mkdir -p ~/.kube
        echo "$KUBE_CONFIG" > ~/.kube/config
        chmod 600 ~/.kube/config [web:21]

    - name: Deploy to Kubernetes [web:21]
      run: |
        kubectl apply -f frontend-deployment.yaml -n recipe-rush --validate=false || true
        kubectl rollout status deployment/recipe-rush-frontend -n recipe-rush --timeout=300s || true
        kubectl get pods,deployments,hpa,ingress,svc -n recipe-rush
        echo "ðŸš€ Recipe Rush Deployed Successfully!" [web:21]
